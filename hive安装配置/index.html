<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hive 安装配置 | CodeInterviews</title>
  <meta name="author" content="CodeInterviews">
  
  <meta name="description" content=" Hive 安装配置">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Hive 安装配置"/>
  <meta property="og:site_name" content="CodeInterviews"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/bootstrap.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-80198899-1', 'auto');
  ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?9a9d27181903a355a8d95344f23682b0";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">CodeInterviews</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>所有文章
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the articles.">
			  <i class="fa fa-archive"></i>分类
			</a>
		  </li>
		  
		  <li>
			<a href="/tags/Java/" title="All about java.">
			  <i class="fa fa-codepen"></i>Java
			</a>
		  </li>
		  
		  <li>
			<a href="/tags/Javascript/" title="All about javascript.">
			  <i class="fa fa-empire"></i>Javascript
			</a>
		  </li>
		  
		  <li>
			<a href="/tags/python/" title="All about Python.">
			  <i class="fa fa-cog"></i>Python
			</a>
		  </li>
		  
		  <li>
			<a href="/tags/Leetcode/" title="All about leetcode.">
			  <i class="fa fa-thumbs-o-up"></i>Leetcode
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-info-circle"></i>关于本站
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header page-header-inverse ">		
			<h1 class="title title-inverse "> Hive 安装配置</h1>
		</div>		
	






<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  
		 <div class="alert alert-success description">
			<i class="fa fa-info-circle"></i> <p> Hive 安装配置</p>
			
		 </div> <!-- alert -->
	  		

	  <p>主要对Hive 安装配置进行介绍。<br><a id="more"></a></p>
<h2 id="二、Hive-运行模式"><a href="#二、Hive-运行模式" class="headerlink" title="二、Hive 运行模式"></a>二、Hive 运行模式</h2><p>与 Hadoop 类似，Hive 也有 3 种运行模式：</p>
<blockquote>
<p><strong>1. 内嵌模式</strong></p>
<p>将元数据保存在本地内嵌的 Derby 数据库中，这是使用 Hive 最简单的方式。但是这种方式缺点也比较明显，因为一个内嵌的 Derby 数据库每次只能访问一个数据文件，这也就意味着它不支持多会话连接。</p>
<p><strong>2. 本地模式</strong></p>
<p>这种模式是将元数据保存在本地独立的数据库中（一般是 MySQL），这用就可以支持多会话和多用户连接了。</p>
<p><strong>3. 远程模式</strong></p>
<p>此模式应用于 Hive 客户端较多的情况。把 MySQL 数据库独立出来，将元数据保存在远端独立的 MySQL 服务中，避免了在每个客户端都安装 MySQL 服务从而造成冗余浪费的情况。</p>
</blockquote>
<h2 id="三、下载安装-Hive"><a href="#三、下载安装-Hive" class="headerlink" title="三、下载安装 Hive"></a>三、下载安装 Hive</h2><p>上节课程我们已经了解到，Hive 是基于 Hadoop 文件系统之上的数据仓库。因此，安装Hive之前必须确保 Hadoop 已经成功安装。（本次实验环境，已经为大家安装好了 Hadoop.）</p>
<p>本次实验，使用Hive V1.1.0版本。Hive V1.1.0 可以在 Hadoop V1.0.0 以上环境中工作。终端下输入命令来下载：</p>
<pre><code>$ wget http://labfile.oss.aliyuncs.com/apache-hive-1.1.0-bin.tar.gz
</code></pre><p>下载完成后解压：</p>
<pre><code>$ tar zxvf apache-hive-1.1.0-bin.tar.gz
</code></pre><p>解压出来的文件名很长，在终端下输入很麻烦，为了后面实验的方便，建议修改为较短文件名，例如：</p>
<pre><code>$ mv apache-hive-1.1.0-bin hive
</code></pre><h2 id="四、配置系统环境变量"><a href="#四、配置系统环境变量" class="headerlink" title="四、配置系统环境变量"></a>四、配置系统环境变量</h2><p>修改 /etc/profile 文件，这个我们在 Hadoop 和 <a href="http://www.shiyanlou.com/courses/37" target="_blank" rel="external">HBase 的课程</a> 中也修改过，应该比较熟悉了。在 PATH 中加入 Hive 的 bin 以及 conf 路径（请根据自己的实际路径修改），使用 <code>sudo vim /etc/profile</code> 来修改：</p>
<pre><code># Hive environment
export HIVE_HOME=/usr/local/hadoop/hive
export PATH=$HIVE_HOME/bin:$HIVE_HOME/conf:$PATH
</code></pre><h2 id="五、内嵌模式"><a href="#五、内嵌模式" class="headerlink" title="五、内嵌模式"></a>五、内嵌模式</h2><p><strong>（1）修改 Hive 配置文件</strong></p>
<p>$HIVE_HOME/conf 对应的是 Hive 的配置文件路径，类似于之前学习的HBase, 该路径下的 hive-site.xml 是 Hive 工程的配置文件。默认情况下，该文件并不存在，我们需要拷贝它的模版来实现：</p>
<pre><code>$ cp hive-default.xml.template hive-site.xml
</code></pre><p>hive-site.xml 的主要配置有：</p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427423801808" alt="图片描述信息"></p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427423813828" alt="图片描述信息"></p>
<blockquote>
<ul>
<li><p><strong>hive.metastore.warehouse.dir</strong><br>该参数指定了 Hive 的数据存储目录，默认位置在 HDFS 上面的 /user/hive/warehouse 路径下。</p>
</li>
<li><p><strong>hive.exec.scratchdir</strong><br>该参数指定了 Hive 的数据临时文件目录，默认位置为 HDFS 上面的 /tmp/hive 路径下。</p>
</li>
</ul>
</blockquote>
<p>同时我们还要修改 Hive 目录下 /conf/hive-env.sh 文件（请根据自己的实际路径修改），该文件默认也不存在，同样是拷贝它的模版来修改：</p>
<pre><code>export HADOOP_HEAPSIZE=1024

# Set HADOOP_HOME to point to a specific hadoop install directory
HADOOP_HOME=/usr/local/hadoop

# Hive Configuration Directory can be controlled by:
export HIVE_CONF_DIR=/usr/local/hadoop/hive/conf

# Folder containing extra ibraries required for hive compilation/execution can be controlled by:
export HIVE_AUX_JARS_PATH=/usr/local/hadoop/hive/lib
</code></pre><p><strong>（2）创建必要目录</strong></p>
<p>前面我们看到 hive-site.xml 文件中有两个重要的路径，切换到 hadoop 用户下查看 HDFS 是否有这些路径：</p>
<pre><code>$ hadoop dfs -ls /
</code></pre><p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427424044890" alt="图片描述信息"></p>
<p>没有发现上面提到的路径，因此我们需要自己新建这些目录，并且给它们赋予用户写（W）权限。</p>
<pre><code>$ hadoop dfs -mkdir /user/hive/warehouse
$ hadoop dfs -mkdir /tmp/hive
$ hadoop dfs -chmod 777 /user/hive/warehouse
$ hadoop dfs -chmod 777 /tmp/hive
</code></pre><p>如果你遇到  <code>no such file or directory</code> 类似的错误，就一步一步新建目录，例如：</p>
<pre><code>$ hadoop dfs -mkdir /tmp
$ hadoop dfs -mkdir /tmp/hive
</code></pre><p>检查是否新建成功 <code>hadoop dfs -ls /</code> 以及 <code>hadoop dfs -ls /user/hive/</code> ：</p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427424512161" alt="图片描述信息"></p>
<p><strong>（3）修改 io.tmpdir 路径</strong></p>
<p>同时，要修改 hive-site.xml 中所有包含 <code>${system:java.io.tmpdir}</code> 字段的 value 即路径（vim下 / 表示搜索，后面跟你的关键词，比如搜索 hello，则为 <code>/hello</code> , 再回车即可），你可以自己新建一个目录来替换它，例如 <code>/home/hive/iotmp</code> . 同样注意修改写权限。如果不修改这个，你很可能会出现如下错误：</p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427424529728" alt="图片描述信息"></p>
<p><strong>（4）运行 Hive</strong></p>
<p>前面我们已经提到过，内嵌模式使用默认配置和 Derby 数据库，所以无需其它特别修改，先 <code>./start-all.sh</code> 启动 Hadoop,  然后直接运行 <code>hive</code>：</p>
<p><strong>你很可能会遇到这个错误：</strong></p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427424670386" alt="图片描述信息"></p>
<p>这是因为 Hive 中的 Jline jar 包和 Hadoop 中的 Jline 冲突了，在路径：$HADOOP_HOME/share/hadoop/yarn/lib/jline-0.9.94.jar 将其删除。</p>
<p>再次启动 <code>hive</code>，就OK了:</p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427424712845" alt="图片描述信息"></p>
<p><code>show tables;</code> 注意不要漏写了 <strong>分号</strong>。</p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427424740729" alt="图片描述信息"></p>
<h2 id="六、本地模式"><a href="#六、本地模式" class="headerlink" title="六、本地模式"></a>六、本地模式</h2><p>现在我们替换默认的 Derby 数据库为 MySQL数据库。</p>
<p><strong>（1）下载安装 MySQL</strong></p>
<pre><code>$ sudo apt-get install mysql-server
</code></pre><p>本实验环境下默认是安装了 MySQL 的，直接启动它：</p>
<pre><code>$ sudo service mysql start
</code></pre><p>添加 root 用户，创建 hive 数据库：</p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427425205044" alt="图片描述信息"></p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427425375983" alt="图片描述信息"></p>
<p>虽然 MySQL 已经默认安装，但我们还需要下载一个 MySQL 的 JDBC 驱动包。这里使用的是 <code>mysql-connector-java-5.1.35-bin.jar</code>，你需要将其复制到  $HIVE_HOME/lib 目录下面：</p>
<pre><code>$ wget http://labfile.oss.aliyuncs.com/mysql-connector-java-5.1.35.tar.gz

$ tar zxvf mysql-connector-java-5.1.35.tar.gz

$ cd mysql-connector-java-5.1.35

$ mv mysql-connector-java-5.1.35-bin.jar /usr/local/hadoop/hive/lib/
</code></pre><p><strong>（2）修改 hive-site.xml 配置文件</strong></p>
<p>最后，依然是修改 $HIVE_HOME/conf 下的 hive-site.xml 文件，把默认的 Derby 修改为 MySQL : </p>
<pre><code>&lt;property&gt;
    &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;
    //所连接的MySQL数据库实例
    &lt;value&gt;jdbc:mysql://localhost:3306/hive&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
    &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;
    //连接的MySQL数据库驱动
    &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
    &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;
    //连接的MySQL数据库用户名
    &lt;value&gt;hive&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
    &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;
    //连接的MySQL数据库密码
    &lt;value&gt;hive&lt;/value&gt;
&lt;/property&gt;
</code></pre><p><strong>（3）启动 Hive</strong></p>
<p>启动 Hive 的方式同内嵌模式一样：</p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427425424217" alt="图片描述信息"></p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
				
    	<li class="prev"><a href="/idea-快捷键/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
  		

        <li><a href="/archives"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/hive简介/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>

    <!-- share -->
    
        
    <div class="bdsharebuttonbox">
        <a href="#" class="bds_more" data-cmd="more"></a>
        <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
        <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
        <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
        <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
        <a href="#" class="bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a>
        <a href="#" class="bds_evernotecn" data-cmd="evernotecn" title="分享到印象笔记"></a>
        <a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a>
        <a href="#" class="bds_copy" data-cmd="copy" title="分享到复制网址"></a>
    </div>
    <script>
        window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};
        with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
    </script>


        

    
	
	<!-- comment -->
	
<section id="comment">
  <h2 class="title">Comments</h2>

  
  	 <div class="ds-thread" data-thread-key="hive安装配置/" data-title="Hive 安装配置" data-url="http://codeinterviews.com/hive安装配置/"></div>  
  
</section>

	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2016-06-29 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/project/">project<span>50</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/Hadoop/">Hadoop<span>17</span></a></li> <li><a href="/tags/Hive/">Hive<span>4</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->

<script type="text/javascript">
  var duoshuoQuery = { short_name: 'codeinterviews' };
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';
    ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2016 CodeInterviews
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
