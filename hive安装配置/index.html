

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    
    <meta name="author" content="CodeInterviews">
    
    <meta name="description" itemprop="description" content=" Hive 安装配置">
    
    

    
    <link rel="alternative" href="atom.xml" title="CodeInterviews" type="application/atom+xml">
    
    
    

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hive 安装配置 | CodeInterviews</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/style.css">

    <!-- Javascript -->
    <script src="/js/jquery-2.1.0.min.js"></script>
    <script src="/js/jquery.backstretch.min.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    <script src="/js/headroom.min.js"></script>
    <script src="/js/jquery.headroom.min.js"></script>
    <script src="/js/common.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <meta name="baidu-site-verification" content="Jvgfj1O0oP" />
    <meta name="360-site-verification" content="902348aeb40d156fb32b748c4071c4bd" />
</head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-inverse" role="banner">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://codeinterviews.com" title="CodeInterviews">CodeInterviews</a>
            </div>

            <div role="navigation" class="collapse navbar-collapse bs-navbar-collapse">
                

                <ul class="nav navbar-nav">
                    
                    <li id="nav-index"><a href="/">首页</a></li>
                    
                    <li id="nav-categories"><a href="/categories">分类</a></li>
                    
                    <li id="nav-tags"><a href="/tags">标签</a></li>
                    
                    <li id="nav-reading"><a href="/tags/#LeetCode">LeetCode</a></li>
                    
                    <li id="nav-labs"><a href="/tags/#Java">Java</a></li>
                    
                    <li id="nav-about"><a href="/tags/#Javascript">Javascript</a></li>
                    

                    <!--<li id="nav-github"><a href="https://github.com/hexo2hexo" target="_blank">GitHub</a></li>-->
                    <li id="nav-rss"><a href="/atom.xml" target="_blank">Rss</a></li>
                    <li id="nav-search"><input type="text" id="search" placeholder="search" /></li>
                </ul>
            </div>
        </div>
    </nav>

    <script>
    var bgRoot = "http://7xkwt1.com1.z0.glb.clouddn.com/background-";
    var bgLength = "74";
    var bgRandom = false;
    var bgImage = "http://7xkwt1.com1.z0.glb.clouddn.com/background-64.jpg";

    $(function() {
        // page-id...
        var pageId = "hive安装配置/";
        pageId = pageId.substr(0, pageId.indexOf("/"));
        if(pageId === "") pageId = "index";

        $("#nav-" + pageId).addClass("active");
    });
    </script>

    <article class="post container">
    <div class="well post-body first-post last-post">
        <h1>Hive 安装配置</h1>

        <div class="time-info">
            
<span class="article-tags">
    
    Tags: <a href="/tags/Hadoop/">Hadoop</a>&nbsp;<a href="/tags/Hive/">Hive</a>&nbsp;
</span>



<span class="article-categories">
    Category:
    <a class="article-category-link" href="/categories/project/">project</a>
</span>


        </div>
        <div class="time-info">
            发表: <time datetime="2016-06-30T03:57:53.000Z"
                       itemprop="datePublished">2016-06-29</time>
            
            更新: <time datetime="2016-06-30T03:57:53.000Z"
                       itemprop="dateModified">2016-06-29</time>
            
        </div>

        <div class="post-body-inner">
            
                <div id="toc" class="toc-article well">
                    <strong class="toc-title">大纲</strong>
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#二、Hive-运行模式"><span class="toc-number">1.</span> <span class="toc-text">二、Hive 运行模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、下载安装-Hive"><span class="toc-number">2.</span> <span class="toc-text">三、下载安装 Hive</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、配置系统环境变量"><span class="toc-number">3.</span> <span class="toc-text">四、配置系统环境变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、内嵌模式"><span class="toc-number">4.</span> <span class="toc-text">五、内嵌模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六、本地模式"><span class="toc-number">5.</span> <span class="toc-text">六、本地模式</span></a></li></ol>
                </div>
            

            <p>主要对Hive 安装配置进行介绍。<br><a id="more"></a></p>
<h2 id="二、Hive-运行模式"><a href="#二、Hive-运行模式" class="headerlink" title="二、Hive 运行模式"></a>二、Hive 运行模式</h2><p>与 Hadoop 类似，Hive 也有 3 种运行模式：</p>
<blockquote>
<p><strong>1. 内嵌模式</strong></p>
<p>将元数据保存在本地内嵌的 Derby 数据库中，这是使用 Hive 最简单的方式。但是这种方式缺点也比较明显，因为一个内嵌的 Derby 数据库每次只能访问一个数据文件，这也就意味着它不支持多会话连接。</p>
<p><strong>2. 本地模式</strong></p>
<p>这种模式是将元数据保存在本地独立的数据库中（一般是 MySQL），这用就可以支持多会话和多用户连接了。</p>
<p><strong>3. 远程模式</strong></p>
<p>此模式应用于 Hive 客户端较多的情况。把 MySQL 数据库独立出来，将元数据保存在远端独立的 MySQL 服务中，避免了在每个客户端都安装 MySQL 服务从而造成冗余浪费的情况。</p>
</blockquote>
<h2 id="三、下载安装-Hive"><a href="#三、下载安装-Hive" class="headerlink" title="三、下载安装 Hive"></a>三、下载安装 Hive</h2><p>上节课程我们已经了解到，Hive 是基于 Hadoop 文件系统之上的数据仓库。因此，安装Hive之前必须确保 Hadoop 已经成功安装。（本次实验环境，已经为大家安装好了 Hadoop.）</p>
<p>本次实验，使用Hive V1.1.0版本。Hive V1.1.0 可以在 Hadoop V1.0.0 以上环境中工作。终端下输入命令来下载：</p>
<pre><code>$ wget http://labfile.oss.aliyuncs.com/apache-hive-1.1.0-bin.tar.gz
</code></pre><p>下载完成后解压：</p>
<pre><code>$ tar zxvf apache-hive-1.1.0-bin.tar.gz
</code></pre><p>解压出来的文件名很长，在终端下输入很麻烦，为了后面实验的方便，建议修改为较短文件名，例如：</p>
<pre><code>$ mv apache-hive-1.1.0-bin hive
</code></pre><h2 id="四、配置系统环境变量"><a href="#四、配置系统环境变量" class="headerlink" title="四、配置系统环境变量"></a>四、配置系统环境变量</h2><p>修改 /etc/profile 文件，这个我们在 Hadoop 和 <a href="http://www.shiyanlou.com/courses/37" target="_blank" rel="external">HBase 的课程</a> 中也修改过，应该比较熟悉了。在 PATH 中加入 Hive 的 bin 以及 conf 路径（请根据自己的实际路径修改），使用 <code>sudo vim /etc/profile</code> 来修改：</p>
<pre><code># Hive environment
export HIVE_HOME=/usr/local/hadoop/hive
export PATH=$HIVE_HOME/bin:$HIVE_HOME/conf:$PATH
</code></pre><h2 id="五、内嵌模式"><a href="#五、内嵌模式" class="headerlink" title="五、内嵌模式"></a>五、内嵌模式</h2><p><strong>（1）修改 Hive 配置文件</strong></p>
<p>$HIVE_HOME/conf 对应的是 Hive 的配置文件路径，类似于之前学习的HBase, 该路径下的 hive-site.xml 是 Hive 工程的配置文件。默认情况下，该文件并不存在，我们需要拷贝它的模版来实现：</p>
<pre><code>$ cp hive-default.xml.template hive-site.xml
</code></pre><p>hive-site.xml 的主要配置有：</p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427423801808" alt="图片描述信息"></p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427423813828" alt="图片描述信息"></p>
<blockquote>
<ul>
<li><p><strong>hive.metastore.warehouse.dir</strong><br>该参数指定了 Hive 的数据存储目录，默认位置在 HDFS 上面的 /user/hive/warehouse 路径下。</p>
</li>
<li><p><strong>hive.exec.scratchdir</strong><br>该参数指定了 Hive 的数据临时文件目录，默认位置为 HDFS 上面的 /tmp/hive 路径下。</p>
</li>
</ul>
</blockquote>
<p>同时我们还要修改 Hive 目录下 /conf/hive-env.sh 文件（请根据自己的实际路径修改），该文件默认也不存在，同样是拷贝它的模版来修改：</p>
<pre><code>export HADOOP_HEAPSIZE=1024

# Set HADOOP_HOME to point to a specific hadoop install directory
HADOOP_HOME=/usr/local/hadoop

# Hive Configuration Directory can be controlled by:
export HIVE_CONF_DIR=/usr/local/hadoop/hive/conf

# Folder containing extra ibraries required for hive compilation/execution can be controlled by:
export HIVE_AUX_JARS_PATH=/usr/local/hadoop/hive/lib
</code></pre><p><strong>（2）创建必要目录</strong></p>
<p>前面我们看到 hive-site.xml 文件中有两个重要的路径，切换到 hadoop 用户下查看 HDFS 是否有这些路径：</p>
<pre><code>$ hadoop dfs -ls /
</code></pre><p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427424044890" alt="图片描述信息"></p>
<p>没有发现上面提到的路径，因此我们需要自己新建这些目录，并且给它们赋予用户写（W）权限。</p>
<pre><code>$ hadoop dfs -mkdir /user/hive/warehouse
$ hadoop dfs -mkdir /tmp/hive
$ hadoop dfs -chmod 777 /user/hive/warehouse
$ hadoop dfs -chmod 777 /tmp/hive
</code></pre><p>如果你遇到  <code>no such file or directory</code> 类似的错误，就一步一步新建目录，例如：</p>
<pre><code>$ hadoop dfs -mkdir /tmp
$ hadoop dfs -mkdir /tmp/hive
</code></pre><p>检查是否新建成功 <code>hadoop dfs -ls /</code> 以及 <code>hadoop dfs -ls /user/hive/</code> ：</p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427424512161" alt="图片描述信息"></p>
<p><strong>（3）修改 io.tmpdir 路径</strong></p>
<p>同时，要修改 hive-site.xml 中所有包含 <code>${system:java.io.tmpdir}</code> 字段的 value 即路径（vim下 / 表示搜索，后面跟你的关键词，比如搜索 hello，则为 <code>/hello</code> , 再回车即可），你可以自己新建一个目录来替换它，例如 <code>/home/hive/iotmp</code> . 同样注意修改写权限。如果不修改这个，你很可能会出现如下错误：</p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427424529728" alt="图片描述信息"></p>
<p><strong>（4）运行 Hive</strong></p>
<p>前面我们已经提到过，内嵌模式使用默认配置和 Derby 数据库，所以无需其它特别修改，先 <code>./start-all.sh</code> 启动 Hadoop,  然后直接运行 <code>hive</code>：</p>
<p><strong>你很可能会遇到这个错误：</strong></p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427424670386" alt="图片描述信息"></p>
<p>这是因为 Hive 中的 Jline jar 包和 Hadoop 中的 Jline 冲突了，在路径：$HADOOP_HOME/share/hadoop/yarn/lib/jline-0.9.94.jar 将其删除。</p>
<p>再次启动 <code>hive</code>，就OK了:</p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427424712845" alt="图片描述信息"></p>
<p><code>show tables;</code> 注意不要漏写了 <strong>分号</strong>。</p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427424740729" alt="图片描述信息"></p>
<h2 id="六、本地模式"><a href="#六、本地模式" class="headerlink" title="六、本地模式"></a>六、本地模式</h2><p>现在我们替换默认的 Derby 数据库为 MySQL数据库。</p>
<p><strong>（1）下载安装 MySQL</strong></p>
<pre><code>$ sudo apt-get install mysql-server
</code></pre><p>本实验环境下默认是安装了 MySQL 的，直接启动它：</p>
<pre><code>$ sudo service mysql start
</code></pre><p>添加 root 用户，创建 hive 数据库：</p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427425205044" alt="图片描述信息"></p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427425375983" alt="图片描述信息"></p>
<p>虽然 MySQL 已经默认安装，但我们还需要下载一个 MySQL 的 JDBC 驱动包。这里使用的是 <code>mysql-connector-java-5.1.35-bin.jar</code>，你需要将其复制到  $HIVE_HOME/lib 目录下面：</p>
<pre><code>$ wget http://labfile.oss.aliyuncs.com/mysql-connector-java-5.1.35.tar.gz

$ tar zxvf mysql-connector-java-5.1.35.tar.gz

$ cd mysql-connector-java-5.1.35

$ mv mysql-connector-java-5.1.35-bin.jar /usr/local/hadoop/hive/lib/
</code></pre><p><strong>（2）修改 hive-site.xml 配置文件</strong></p>
<p>最后，依然是修改 $HIVE_HOME/conf 下的 hive-site.xml 文件，把默认的 Derby 修改为 MySQL : </p>
<pre><code>&lt;property&gt;
    &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;
    //所连接的MySQL数据库实例
    &lt;value&gt;jdbc:mysql://localhost:3306/hive&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
    &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;
    //连接的MySQL数据库驱动
    &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
    &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;
    //连接的MySQL数据库用户名
    &lt;value&gt;hive&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
    &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;
    //连接的MySQL数据库密码
    &lt;value&gt;hive&lt;/value&gt;
&lt;/property&gt;
</code></pre><p><strong>（3）启动 Hive</strong></p>
<p>启动 Hive 的方式同内嵌模式一样：</p>
<p><img src="https://dn-anything-about-doc.qbox.me/userid46108labid766time1427425424217" alt="图片描述信息"></p>


            <div class="post-info">
    <p class="eof">- EOF -</p>
    <p class="copyright">All rights reserved <a href="http://www.codeinterviews.com">@codeinterviews</a>.</p>
    <p class="link">本文链接：<a href="http://codeinterviews.com/hive安装配置/">http://codeinterviews.com/hive安装配置/</a></p>
    <div class="share">
        分享本文：
        <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a>
    <a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a>
</div>

<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

    </div>
</div>


            
    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'disqus_username';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



        </div>
    </div>
</article>

    <footer id="footer">
        <div id="bottom-tip">
            CodeInterviews
        </div>
        <small>该博客由 <a href="https://hexo.io/" target="_blank">Hexo</a> 强力驱动，搭载 <a href="https://github.com/gejiawen/hexadillax2" target="_blank">Hexadillax2</a> 主题</small><br />
        <!--<small>如果你访问github速度过慢，可移步本站的备份站点<a href="http://gejiawen.gitcafe.io">gejiawen.gitcafe.io</a></small><br />-->
        <small>&copy; 2016 <a href="http://codeinterviews.com" target="_blank">CodeInterviews</a>&nbsp;<a href="http://www.miitbeian.gov.cn/" target="_blank">皖ICP备16008778号</a></small>
    </footer>
    
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e4dd778a6204eb51e4f25460e37481ad";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-51347904-1', 'auto');
  ga('send', 'pageview');
</script>


</body>
</html>

